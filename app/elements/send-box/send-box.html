<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../bower_components/iron-a11y-keys/iron-a11y-keys.html">

<script src="https://cdnjs.cloudflare.com/ajax/libs/buzz/1.1.10/buzz.min.js"></script>

<dom-module id="send-box">
  <template>
    <style>
      :host {
        display: block;
        box-sizing: border-box;
        max-width: 512px;
      }
      
      #cardMessage {
        background-color: #FFFFFF;
        margin: 12px;
        min-height: 64px;
        padding: 8px;
      }
      
      #messageContent {
        
      }
      
      paper-button.green {
        color: var(--paper-light-green-500);
        --paper-button-flat-focus-color: var(--paper-light-green-50);
        
        -webkit-transition: 0.2s;
        transition: 0.2s;
      }
      paper-button.green:hover {
        background: var(--paper-light-green-50);
        
        -webkit-transition: 0.2s;
        transition: 0.2s;
      }
      paper-button.ripple {
        --paper-button-ink-color: var(--paper-green-a200);
      }
      
      #sendButton {
        height: 40px;
      }
      
      paper-icon-button.small {
        color: #727272;
        
        margin: 0px;
        
        -webkit-transition: 0.2s;
        transition: 0.2s;
      }
      
      paper-icon-button.small:hover {
        color: #333333;
        
        -webkit-transition: 0.2s;
        transition: 0.2s;
      }
      
      paper-icon-button.small.ripple {
        --paper-button-ink-color: var(--paper-green-a200);
      }
      
    </style>

    <iron-a11y-keys
      id="keys"
      keys="shift+enter || enter"
      target="[[target]]"
      on-keys-pressed="_updatePressed">
    </iron-a11y-keys>

    <paper-material elevation="1" flex id="cardMessage">
      <form is="iron-form" id="form" method="post" action="http://api.oversimplified.io/message">
        <paper-input name="content" label="Send a message" id="messageContent"></paper-input>
        <paper-input name="type" value="text" hidden></paper-input>
        <paper-input name="userId" value="56154da0d32c233e52f30815" hidden></paper-input>
        
        <div class="horizontal layout">
          <div>
            <paper-icon-button icon="editor:insert-emoticon" class="small" id="emoticonButton"></paper-icon-button>
            <paper-icon-button icon="editor:insert-photo" class="small" id="photoButton"></paper-icon-button>
            <paper-icon-button icon="editor:insert-drive-file" class="small" id="fileButton"></paper-icon-button>
            <paper-icon-button icon="editor:insert-chart" class="small" id="chartButton"></paper-icon-button>
            <paper-icon-button icon="room" class="small" id="roomButton"></paper-icon-button>
          </div>
          <div class="flex"> </div>
          <div>
            <paper-button on-click="submitForm" class="green ripple" id="sendButton"><iron-icon icon="send"></iron-icon> Send</paper-button>
          </div>
        </div>
        <!--
        <div class="horizontal end-justified layout">
          <paper-button on-click="submitForm" class="green ripple" id="send-button"><iron-icon icon="send"></iron-icon>Send</paper-button>
          <iron-a11y-keys
            id="keys"
            keys="shift+enter || enter"
            target="[[target]]"
            on-keys-pressed="_updatePressed">
          </iron-a11y-keys>
        </div>
        -->
      </form>
    </paper-material>

  </template>

</dom-module>

<script>
  Polymer({
    is: 'send-box',
    properties: {
      target: {
        type: Object,
        value: function() {
          return document.body;
        }
      }
    },
    
    submitForm: function() {
      if (this.$.messageContent.value != "") {
        
        this.$.form.submit();
        this.snd();
        this.$.messageContent.value = "";
      }
    },
    
    _updatePressed: function(event) {
      this.submitForm();
    },
    
    snd: function() {
      var mySound = new buzz.sound( "../../sounds/load", {
          formats: [ "wav"],
          preload: true
      });
      
      mySound.play();
    }
  });
</script>

<!--

<form is="iron-form" id="form" method="post" action="http://back.oversimplified.io/message">
 <paper-input name="content" label="content"></paper-input>
 <input name="type" value="text" hidden>
 <input name="userId" value="56154da0d32c233e52f30815" hidden>
<paper-button raised onclick="submitForm()">Send</paper-button>
</form>

<script>
function submitForm() {
 document.getElementById('form').submit();
}

-->