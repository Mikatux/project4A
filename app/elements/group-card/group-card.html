<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="group-card">

    <template>
        <style>
            :host {
                display: block;
                position: relative;
            }

            #cardMessage {
                background-color: #FFFFFF;
                margin: 0;
                padding: 0;
                width: 300px;
                height-min: 400px;

                transition: 0.2s;
                -webkit-transition: 0.2s;
            }

            .cover {
                border-radius: 2px 2px 0px 0px;
                width: 300px;
                height: 300px;
                position: relative;
                padding: 0;
                margin: 0;
            }

            #nameContainer {
                margin: 16px;
            }

            .username {
                font-size: 18px;
                text-transform: capitalize;
                font-weight: 500;
                color: var(--accent-color);
                line-height: 1.3em;
                max-width: 90%;
                text-overflow: ellipsis;
                overflow: hidden;
                white-space: nowrap;
            }

            .timestamp {
                font-size: 14px;
                font-weight: 300;
                color: #b5a896;
                line-height: 1.3em;
                max-width: 90%;
                text-overflow: ellipsis;
                overflow: hidden;
                white-space: nowrap;
            }

            .separator {
                height: 1px;
                width: 100%;
                background-color: var(--primary-background-color);
            }

            #head {
                padding: 4px;
                background-color: #FDFDFD;
            }

            #name-zone {
                padding-left: 16px;
            }

        </style>


        <iron-ajax
                id="request"
                auto=false
                url="[[computeURL(group.id)]]"
                type="DELETE"
                on-response="handleResponse()"
        ></iron-ajax>

        <paper-material elevation="1" id="cardMessage" on-mouseover="mouseOver" on-mouseout="mouseOut" on-click="onClick">
            <div>
                <img src="{{group.img}}" alt="[[group.img]]" class="cover">
            </div>

            <div id="nameContainer">
                <span class="username">{{group.name}}</span>
                <br>
                <span class="timestamp">{{computeDate(group.date)}}</span>
                <br>
                <span></span>
            </div>

            <div class="separator"></div>

            <div>
                <template is="dom-repeat" items="{{item.members}}">

                    <span>[[item]]</span>
                    <!--<span>http://api.oversimplified.io/users/[[item.]</span>-->
                    <br>
                </template>
            </div>
        </paper-material>
    </template>
</dom-module>

<script>
    Polymer({
        is: 'group-card',
        properties: {
            group: Object
        },
        computeURL: function (id) {
            return "http://api.oversimplified.io/groups/" + id;
        },
        computeDate: function (date) {
            var d = date.split("T")[0];
            var h = date.split("T")[1].substring(0, 5);

            d = new Date(d.split(':')).toString().substring(4, 15);

            return d + ", " + h;
        },
        mouseOver: function () {
            this.$.cardMessage.elevation = 4;
            this.$.cardMessage.style.marginTop = "-4px";
        },
        mouseOut: function () {
            this.$.cardMessage.elevation = 1;
            this.$.cardMessage.style.marginTop = "0px";
        },
        onClick: function () {
            console.log("DELETE " + this.group.id + " | " + this.group);
            this.$.request.generateRequest();
        },
        handleResponse: function () {
            console.log("Ok");
        }
    });
</script>