<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="menu-group-list">

    <template>
        <style>
            .title {
                color: #5e5d5e;
                font-weight: 600;
                margin: 4px 4px 4px 40px;
                height: 32px;
                transition: 0.2s;
                overflow: hidden;
            }

            .title:hover {
                color: #4185f6;
                margin: 4px 4px 4px 50px;
                transition: 0.2s;
            }

            .title img {
                border-radius: 2px;
                margin-right: 8px;
                height: 32px;
                width: 32px;
            }
        </style>

        <iron-ajax
                id="request"
                url=""
                handle-as="json"
                last-response="{{response}}"></iron-ajax>

        <div class="layout vertical">
            <template is="dom-repeat" items="{{response.groups}}" as="request">
                <iron-ajax
                        auto
                        url="{{groupURL(item)}}"
                        handle-as="json"
                        on-response="handelResponse"></iron-ajax>
            </template>

            <template is="dom-repeat" items="{{groups}}" id="titleList" as="group" index-as="groupId">
                <div class="layout horizontal title">
                    <span class="groupTitle">[[group._id]]</span>
                    <span class="groupTitle">[[groupId]]</span>
                    <img class="groupCover" src="[[group.img]]">
                    <span class="groupTitle">{{item.name}}</span>
                    <span class="groupTitle">{{item}}</span>
                </div>
            </template>
        </div>

    </template>
</dom-module>

<script>
    Polymer({
        is: 'menu-group-list',
        properties: {
            groups: {
                type: Object,
                value: [],
                computed: 'getGroups()'
            }
        },
        computeURL: function() {
            var id = app.getUserId();
            return 'http://api.oversimplified.io/users/' + id;
        },
        groupURL: function (id) {
            return 'http://api.oversimplified.io/groups/' + id;
        },
        getGroups: function () {
            console.log("getGroup: " + this.groups);
            return this.groups;
        },
        handelResponse: function (request) {
            this.groups.push(request.detail.response);
            this.$.titleList.render();

            console.log(this.groups);
            console.log(this.groups[0].name);
            console.log(this.groups[0].img);
        },
        refresh: function () {
            this.$.request.url = this.computeURL();
            this.$.request.generateRequest();
        }
    });
</script>